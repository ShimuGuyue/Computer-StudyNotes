> æœ¬ç¬”è®°ä¸­å‡å®šç®—æ³•è®²è§£ä¸­å­—ç¬¦ä¸²ä¸‹æ ‡ä» $1$ å¼€å§‹ï¼Œä»£ç ä¸­ä¸‹æ ‡ä» $0$ å¼€å§‹ã€‚

# borderï¼Œå‘¨æœŸå’Œå¾ªç¯èŠ‚

## border

å¦‚æœå­—ç¬¦ä¸² $S$ çš„ä¸€ä¸ªå­—ä¸²**æ—¢æ˜¯å®ƒçš„å‰ç¼€ï¼Œåˆæ˜¯å®ƒçš„åç¼€**ï¼Œåˆ™è¯¥å­—ä¸²æˆä¸º $S$ çš„ä¸€ä¸ª **border**ã€‚

* ç‰¹æ®Šåœ°ï¼Œå­—ç¬¦ä¸²æœ¬èº«ä¹Ÿå¯æ˜¯æ˜¯ä»–çš„ borderï¼Œå…·ä½“æ ¹æ®è¯­å¢ƒåˆ¤æ–­ã€‚
* ç‰¹æ®Šåœ°ï¼Œborder ä¹Ÿå¯ä»¥æŒ‡è¿™ä¸ªå­—ä¸²çš„é•¿åº¦ï¼Œå…·ä½“æ ¹æ®è¯­å¢ƒåˆ¤æ–­ã€‚

**ä¾‹ï¼š**

>$S$ï¼š
>
>```
>bbabbab
>```
>
>$S$ çš„æ‰€æœ‰ borderï¼š
>
>```
>b
>bbab
>bbabbab
>```

**ğŸ§© border çš„ä¼ é€’æ€§ï¼š**

$S$ çš„ border çš„ border ä¹Ÿæ˜¯ $S$ çš„ borderã€‚

æ±‚ $S$ çš„æ‰€æœ‰ border ç­‰ä»·äºæ±‚æ‰€æœ‰å‰ç¼€çš„æœ€å¤§ borderã€‚

## å‘¨æœŸ

å¯¹äºå­—ç¬¦ä¸² $S$ å’Œæ­£æ•´æ•° $p$ï¼Œå¦‚æœå¯¹äºä»»æ„ $i$ï¼Œéƒ½æœ‰ $p \lt i \leq \lvert S \rvert$ï¼Œåˆ™ç§° $p$ ä¸ºå­—ç¬¦ä¸² $S$ çš„ä¸€ä¸ª**å‘¨æœŸ**ã€‚

- ç‰¹æ®Šåœ°ï¼Œ$p = \lvert S \rvert$ ä¸€å®šæ˜¯ $S$ çš„å‘¨æœŸã€‚

**ä¾‹ï¼š**

> $S$ï¼š
>
> ```
> bbabbab
> ```
>
> $S$ çš„æ‰€æœ‰å‘¨æœŸï¼š
>
> ```
> bba
> bbabba
> bbabbab
> ```

ğŸ§© **border ä¸å‘¨æœŸçš„å…³ç³»ï¼š**$p$ æ˜¯ $S$ çš„ border $\iff$ $\lvert S \rvert - p$ æ˜¯ $S$ çš„å‘¨æœŸã€‚

ğŸ§© **å‘¨æœŸå®šç†ï¼š**è‹¥ $p, q$ å‡ä¸º $S$ çš„å‘¨æœŸï¼Œåˆ™ $\gcd(p, q)$ ä¹Ÿä¸º $S$ çš„å‘¨æœŸã€‚

ğŸ§© ä¸€ä¸ªä¸²çš„ Boredr æ•°é‡ä¸º $n$ï¼Œä»–ä»¬ç»„æˆäº† $\log n$ ä¸ªç­‰å·®æ•°åˆ—ã€‚

## å¾ªç¯èŠ‚

è‹¥å­—ç¬¦ä¸² $S$ çš„å‘¨æœŸ $p$ æ»¡è¶³ $p \mid \lvert S \rvert$ï¼Œåˆ™ç§° $p$ ä¸º $S$ çš„ä¸€ä¸ª**å¾ªç¯èŠ‚**ã€‚

* ç‰¹æ®Šåœ°ï¼Œ$p = \lvert S \rvert$ ä¸€å®šæ˜¯ $S$ çš„å¾ªç¯èŠ‚ã€‚

**ä¾‹ï¼š**

> $S$ï¼š
>
> ```
> bbabbabba
> ```
>
> $S$ çš„æ‰€æœ‰å¾ªç¯èŠ‚ï¼š
>
> ```
> bba
> bbabbabba
> ```

---

# next æ•°ç»„

`next[i]` è¡¨ç¤º `preffix[i]` çš„éå¹³å‡¡æœ€å¤§ borderã€‚è‡³äºä¸ºä»€ä¹ˆå«åš next æ•°ç»„ï¼Œè¯¦è§[KMP ç®—æ³•](# KMP ç®—æ³•)åŸç†ã€‚

æ±‚è§£ `next[i]` æ—¶ï¼Œéå† `preffix[i]` çš„æ‰€æœ‰ borderï¼Œå³ `next[i-1], next[next[i-1]], ..., 0`ï¼Œæ£€æŸ¥åä¸€ä¸ªå­—ç¬¦æ˜¯å¦ç­‰äº `S[i]`ï¼Œå¦‚æœç­‰äºï¼Œåˆ™ `next[i]` ä¸ºå½“å‰æ‰€æ£€æŸ¥çš„ border åŠ  $1$ã€‚

```c++
vector<int> buildNexts(const string &s)
{
	const int n = s.length();
	vector<int> nexts(n);
	for (int i = 1; i < n; ++i)
	{
		nexts[i] = nexts[i-1];
		while (nexts[i] > 0 && s[i] != s[nexts[i]])
		{
			nexts[i] = nexts[nexts[i] - 1];
		}
		if (s[i] == s[nexts[i]])
			++nexts[i];
	}
	return nexts;
}
```

---

# KMP ç®—æ³•

KMP ç®—æ³•ç”¨äºå¿«é€Ÿåœ¨ä¸»ä¸²ä¸­æŸ¥æ‰¾æ¨¡å¼ä¸²å‡ºç°çš„ä½ç½®ï¼Œç›¸è¾ƒäºæš´åŠ›åŒ¹é…ï¼ŒKMP ä½¿ç”¨ border çš„æ€§è´¨å’Œæ¨¡å¼ä¸²çš„ next æ•°ç»„è¿›è¡Œå¿«é€Ÿè·³è½¬ï¼Œé¿å…è®¸å¤šä¸å¿…è¦çš„çŠ¶æ€æœç´¢ã€‚

KMP ç®—æ³•ä¸­ï¼Œä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆ $i, j$ åˆ†åˆ«è¡¨ç¤ºä¸»ä¸²å’Œæ¨¡å¼ä¸²å½“å‰éå†åˆ°çš„ä½ç½®ï¼Œå…¶ä¸­ä¸»ä¸²æŒ‡é’ˆä¸æ–­å‰è¿›ï¼Œä»…æœ‰æ¨¡å¼ä¸²çš„æŒ‡é’ˆåœ¨å­—ç¬¦ä¸åŒ¹é…æ—¶è¿›è¡Œå›æº¯ã€‚

ç›¸è¾ƒäºæš´åŠ›åŒ¹é…æ¯æ¬¡å­—ç¬¦ä¸åŒ¹é…æ—¶ç›´æ¥å›åˆ°èµ·ç‚¹ï¼ŒKMP ç®—æ³•å°†æŒ‡é’ˆ $j$ çš„ä½ç½®å›æº¯è‡³ `nexts[j-1] + 1` çš„ä½ç½®è¿›è¡Œä¸‹ä¸€è½®åŒ¹é…ï¼Œè€Œä¸éœ€è¦è¿›è¡Œå‰è¾¹å­—ç¬¦çš„åŒ¹é…ã€‚è¿™æ˜¯å› ä¸º $S[1, \dots , j-1]$ çš„æœ€å¤§ border ä¸º `nexts[j-1]`ï¼Œè€Œå·²çŸ¥ä¸»ä¸²å·²åŒ¹é…éƒ¨åˆ†çš„åç¼€ä¸æ¨¡å¼ä¸²å·²åŒ¹é…éƒ¨åˆ†çš„åç¼€ç›¸åŒï¼Œåˆ©ç”¨ next æ•°ç»„ä¸­å­˜å‚¨çš„æœ€å¤§ borderï¼Œå¯è¯æ˜ä¸»ä¸²ä»¥åŒ¹é…éƒ¨åˆ†åç¼€é•¿åº¦ä¸º border çš„éƒ¨åˆ†ä¸æ¨¡å¼ä¸²å‰ç¼€é•¿åº¦ä¸º border çš„éƒ¨åˆ†ç›¸åŒ¹é…ï¼Œå› æ­¤è¿™æ®µåŒºé—´æ— éœ€å†æ¬¡å°è¯•åŒ¹é…ï¼Œå°†æ¨¡å¼ä¸²æŒ‡é’ˆç§»åŠ¨åˆ° `nexts[j-1] + 1` å°è¯•è¿›è¡Œä¸‹ä¸ªä½ç½®çš„åŒ¹é…å³å¯ã€‚

>è¿™ä¹Ÿæ˜¯ `next` æ•°ç»„åç§°çš„ç”±æ¥â€”â€”å®ƒæŒ‡æ˜äº†æ¨¡å¼ä¸²åŒ¹é…å¤±è´¥æ—¶ï¼ŒæŒ‡é’ˆåº”è·³è½¬çš„â€œä¸‹ä¸€ä¸ªâ€ä½ç½®ã€‚

**ä¾‹ï¼š**

>ä¸»ä¸²ï¼š
>
>```
>a a b a a b a a f
>```
>
>æ¨¡å¼ä¸²ï¼š
>
>```
>a a b a a f
>```
>
>æ¨¡å¼ä¸²çš„ next æ•°ç»„ï¼š
>
>```
>0 1 0 1 2 0
>```
>
>å½“ $i = 6, j = 6$ çš„ä½ç½®åŒ¹é…å¤±è´¥æ—¶ï¼Œç”±äºä¸² `aabaa` çš„æœ€å¤§ border ä¸º `aa`ï¼Œå·²çŸ¥ä¸»ä¸²çš„ $i-1$ ä½ç½®ä¹‹å‰çš„ `aa` å’Œæ¨¡å¼ä¸² $S[1, \dots , j-1]$ çš„åç¼€ `aa` æˆåŠŸåŒ¹é…ï¼Œåˆ™è¿™æ®µä¸»ä¸²å’Œæ¨¡å¼ä¸²çš„å‰ç¼€ `aa` ä¹Ÿå¯æˆåŠŸåŒ¹é…ï¼Œè€Œå½“å‰ $i$ æŒ‡é’ˆä½äº `aa` çš„åä¸€ä¸ªä½ç½®ï¼Œå› æ­¤å°† $j$ æŒ‡é’ˆç§»åŠ¨åˆ°æ¨¡å¼ä¸²çš„å‰ç¼€ `aa` çš„ä¸‹ä¸€ä¸ªä½ç½®å³ `nexts[j-1] + 1` è¿›è¡Œä¸‹ä¸€è½®åŒ¹é…ï¼Œè·³è¿‡å‰è¾¹å·²çŸ¥ä¸€å®šå¯ä»¥åŒ¹é…æˆåŠŸçš„éƒ¨åˆ†ï¼Œå°è¯•åœ¨ä¸‹ä¸ªä½ç½®ç»§ç»­åŒ¹é…ã€‚

```c++
int kmp(const string &s, const string &t)
{
	// å»ºç«‹æ¨¡å¼ä¸²çš„ next æ•°ç»„
	vector<int> nexts = buildNexts(t);

	const int n = s.length();
	const int m = t.length();
	int i = 0, j = 0;
	while (i < n)
	{
		if (s[i] == t[j])
		{
			// å½“å‰ä½ç½®åŒ¹é…æˆåŠŸï¼Œå°è¯•åŒ¹é…ä¸‹ä¸ªä½ç½®
			++i;
			++j;
			// æ¨¡å¼ä¸²åŒ¹é…å®Œæˆï¼Œè¿”å›ä¸»ä¸²ä¸­åŒ¹é…åˆ°çš„èµ·å§‹ä½ç½®
			if (j == m)
				return i - m;
		}
		else
		{
			// åŒ¹é…ä¸æˆåŠŸåˆ™è·³è½¬ j æŒ‡é’ˆ
			if (j != 0)
				j = nexts[j-1];
			// å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦éƒ½ä¸åŒ¹é…ï¼Œåªéœ€å°† i æŒ‡é’ˆç§»åŠ¨åˆ°ä¸‹ä¸€å¤„å³å¯
			else
				++i;
		}
	}
	// åŒ¹é…å¤±è´¥è¿”å› -1
	return -1;
}
```

å¦‚æœéœ€è¦æ‰¾å‡ºæ‰€æœ‰åŒ¹é…çš„å­—ä¸²ä½ç½®ï¼Œåªéœ€æ¯æ¬¡æ‰¾åˆ°å®Œå…¨åŒ¹é…çš„å­—ä¸²ä¹‹åï¼Œç±»æ¯”åŒ¹é…å¤±è´¥çš„æƒ…å†µï¼Œå°† $j$ æŒ‡é’ˆè½¬ç§»åˆ°`nexts[j] + 1` ï¼ˆä¸æ˜¯è½¬ç§»åˆ° `nexts[j-1] + 1` å› ä¸ºå½“å‰ä½ç½®æ˜¯åŒ¹é…æˆåŠŸçš„ï¼‰çš„ä½ç½®ç»§ç»­ä¸‹ä¸€è½®åŒ¹é…å³å¯ã€‚

```c++
vector<int> kmp(const string &s, const string &t)
{
	vector<int> indexs;
	vector<int> nexts = buildNexts(t);

	const int n = s.length();
	const int m = t.length();
	int i = 0, j = 0;
	while (i < n)
	{
		if (s[i] == t[j])
		{
			++i;
			++j;
			// æ¨¡å¼ä¸²å®Œå…¨åŒ¹é…åˆ™è®°å½•å­ä¸²èµ·å§‹ä½ç½®ï¼Œè·³è½¬ j æŒ‡é’ˆ
			if (j == m)
			{
				indexs.push_back(i - m);
				// ç”±äºå‰è¾¹ ++j æ“ä½œï¼Œéœ€å°† j æŒ‡é’ˆå›è°ƒ
				j = nexts[j-1];
			}
		}
		else
		{
			if (j != 0)
				j = nexts[j-1];
			else
				++i;
		}
	}
	// è¿”å›æ‰€æœ‰å­—ä¸²èµ·å§‹ä¸‹æ ‡
	return indexs;
}
```

---

# æ¨¡æ¿

```c++
class KMP
{
private:
	string pattern{};
	vector<int> nexts{};

public:
	KMP()
	{}
	KMP(const string &s)
	{
		build(s);
	}

public:
	void build(const string &s)
	{
		pattern = s;
		const int n = s.length();
		nexts.assign(n, 0);
		for (int i = 1; i < n; ++i)
		{
			nexts[i] = nexts[i - 1];
			while (nexts[i] > 0 && s[nexts[i]] != s[i])
			{
				nexts[i] = nexts[nexts[i] - 1];
			}
			if (s[nexts[i]] == s[i])
				++nexts[i];
		}
	}

	int32_t match(const string &text)
	{
		const int n = text.length();
		const int m = pattern.length();
		int i = 0, j = 0;
		while (i < n)
		{
			if (text[i] == pattern[j])
			{
				++i;
				++j;
				if (j == m)
					return i - m;
			}
			else
			{
				if (j != 0)
					j = nexts[j - 1];
				else
					++i;
			}
		}
		return -1;
	}

	vector<int> match_all(const string &text)
	{
		vector<int> indexs;

		const int n = text.length();
		const int m = pattern.length();
		int i = 0, j = 0;
		while (i < n)
		{
			if (text[i] == pattern[j])
			{
				++i;
				++j;
				if (j == m)
				{
					indexs.push_back(i - m);
					j = nexts[j - 1];
				}
			}
			else
			{
				if (j != 0)
					j = nexts[j - 1];
				else
					++i;
			}
		}
		return indexs;
	}
};
```

---

# ä¾‹é¢˜

[P3375 ã€æ¨¡æ¿ã€‘KMP - æ´›è°·](https://www.luogu.com.cn/problem/P3375)ï¼ˆæ¨¡æ¿ï¼‰

